<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>datasetSearch</title>
    <link rel="stylesheet" type="text/css"
          href="http://127.0.0.1:8000/static/plugins/bootstrap-3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/static/css/global.css"/>
    <link rel="stylesheet" href="http://127.0.0.1:8000/static/css/datasetSearch.css">
    <script type="text/javascript" src="http://127.0.0.1:8000/static/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript"
            src="http://127.0.0.1:8000/static/plugins/bootstrap-3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://127.0.0.1:8000/static/js//highcharts/highcharts.js"></script>
    <script type="text/javascript" src="http://127.0.0.1:8000/static/js//highcharts/exporting.js"></script>
    <script type="text/javascript" src="http://127.0.0.1:8000/static/js//highcharts/highcharts-zh_CN.js"></script>
    <script type="text/javascript" src="http://127.0.0.1:8000/static/js/echarts.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style>
        .search-box {
            float: left;
            width: 270px;
            display: block;
            height: 36px;
            margin: 10px 0 0 0;
            font-size: 15px;
            color: #555555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
        }

        .search-box-first {
            width: 600px;
            display: block;
            height: 36px;
            margin: 40px auto;
            text-align: center;
            font-size: 15px;
            color: #555555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
        }

        .search_button {
            height: 36px;
            margin: 10px 0 0 0;
        }

        .search-content {
            height: 600px;
        }

        .input_result{
            display: flex;
            justify-content: center;
        }

        .Search-prompt-information {
            margin: 50px 0 -25px 0;
            text-align: center;
            font-size: 20px;
        }

        .glyphicon-th-list {
            margin: 3px 0 0 20px;
            {#margin-left: 10px;#}
            font-size: 16px;
            {#line-height: 40px;#}
        }

        .dataset{
            margin-right: 50px;
        }

        .info-box {
            position: absolute;
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            display: none;
        }

        .notext {
            font-size: 24px;
            margin: 50px auto;
            text-align: center;
            font-weight: bold;
        }

        .analyse_results{
            color: #3c763d;
        }

        .centrality_button {
            float: left;
            font-size: 18px;
            height: 40px;
            width: 120px;
            text-align: center;
            line-height: 40px;
            margin: -15px 10px 16px 10px;
            border-radius: 13px;
            padding: 0;
            background-color: #94b8e5;
        }

        #centrality_select_button{
            text-align: center; /* 设置文本居中 */
            display: flex; /* 使用 Flexbox 布局 */
            justify-content: center; /* 在主轴上水平居中 */
        }

        #navigation {
            z-index: 1000; /* 设置较高的z-index值，确保导航栏在上层显示 */
            padding: 0;
            position: fixed;
            top: 50%; /* 垂直居中 */
            right: 25px;
            transform: translateY(-50%); /* 竖直居中 */
            width: 210px;
            border: 1px solid #736d73;
            border-radius: 10px;
        }

        #navigation li {
            list-style: none;
            margin: 10px 0;
            padding: 0;
        }

        #navigation a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            display: block;
            transition: color 0.3s;
            font-size: 20px;
            text-align: center;
            width: 210px;
        }

        #navigation button{
            height: 50px;
            background-color: white;
            border-radius: 5px;
            border: none;
        }

        #navigation a:hover {
            font-size: 27px;
            color: #0070c9;
        }

    </style>
</head>
<body>
<div id="head">
    <img src="../static/img/logo.png" alt="Logo"/>
    <div id="menu1">
        <ul id="supnav">
            <li><a href="/index/"><span class="glyphicon glyphicon-home"></span>Home</a></li>
            <li class="active"><a><span class="glyphicon glyphicon-search"></span>Search<span class="caret"></span></a>
                <div class="browse" id="search">
                    <a href="/datasetSearch/">Transcriptome data Search</a>
                    <a href="/geneSearch/">Gene Search</a>
                    <a href="/methylationSearch/">Methylation data Search</a>
                </div>
            </li>
            <li><a href="/upload/"><span class="glyphicon glyphicon-cloud-upload"></span>Analyse</a></li>
            <li><a href="/help/"><span class="glyphicon glyphicon-file"></span>Help</a></li>
            <li><a><span class="glyphicon glyphicon-download-alt"></span>Download<span class="caret"></span></a>
                <div class="browse">
                    <a href="/download/">Transcriptome results</a>
                    <a href="/methylationdownload/">Methylation results</a>
                </div>
            </li>
            <li><a href="/contact/"><span class="glyphicon glyphicon-earphone"></span>Contact us</a></li>
        </ul>
    </div>
</div>
<div class="container {% if data11 %}{% else %}search-content{% endif %}" id="background">
    <div style="margin-bottom: 10px" class="clearfix">
        <div>
            <form method="get">
                <div class="input-group {% if search_data1 %}input_result{% endif %}">
                    <div class="Search-prompt-information" {% if data11 %}hidden{% endif %}>Choose a species, human or
                        mouse
                    </div>
                    <select id="species" name="a"
                            class="{% if data11 %}search-box{% else %}search-box-first{% endif %}"
                            value="{{ search_data1 }}" onchange="loadDrug()">
                    </select>
                    <div class="Search-prompt-information" {% if data11 %}hidden{% endif %}>Choose an addictive drug
                    </div>
                    <select id="drug" name="b" class="{% if data11 %}search-box{% else %}search-box-first{% endif %}"
                            value="{{ search_data2 }}" onchange="loadArea()">
                    </select>
                    <div class="Search-prompt-information" {% if data11 %}hidden{% endif %}>Choose a brain region</div>
                    <select id="area" name="c" class="{% if data11 %}search-box{% else %}search-box-first{% endif %}"
                            value="{{ search_data3 }}" onchange="loadDataset()">
                    </select>
                    <div class="Search-prompt-information" {% if data11 %}hidden{% endif %}>Choose the corresponding
                        dataset
                    </div>
                    <select id="dataset" name="d"
                            class="{% if data11 %}search-box dataset{% else %}search-box-first{% endif %}"
                            value="{{ search_data4 }}">
                    </select>

                    <span class="input-group-btn">
                        <button class="btn btn-default {% if data11 %}search_button{% else %}search_button-first{% endif %}"
                                type="submit" id="search_button">
                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                      </span>
                </div>
            </form>
        </div>
    </div>
    <div class="Search-results {% if search_data4 %}show{% endif %}">
        {#        差异基因结果#}
        <h1>Analysis Results of
            <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc={{ search_data4 }}">{{ search_data4 }}</a>
            Dataset</h1>
        <ul id="navigation">
            <li><a href="#DEGs_Section"><button>DEGs</button></a></li>
            <li><a href="#volcanoPlot_Section"><button>Volcano plot</button></a></li>
            <li><a href="#ppi"><button>PPI network</button></a></li>
            <li><a href="#centrality_Section"><button>Centrality</button></a></li>
            <li><a href="#go_Section"><button>GO term</button></a></li>
            <li><a href="#kegg_Section"><button>KEGG pathway</button></a></li>
        </ul>
        <div class="content">
            <div id="DEGs_Section" class="title">Differentially Expressed Genes</div>
            <table>
                <thead>
                <tr>
                    <th>Significance threshold</th>
                    <th>|FoldChange|>1.2</th>
                    <th>|FoldChange|>1.5</th>
                    <th>|FoldChange|>2</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>P<0.05</th>
                    <th><a id="n11_results" class="analyse_results">{{ n11 }}</a><a id="n11" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                    <th><a id="n12_results" class="analyse_results">{{ n12 }}</a><a id="n12" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                    <th><a id="n13_results" class="analyse_results">{{ n13 }}</a><a id="n13" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                </tr>
                <tr>
                    <th>P<0.01</th>
                    <th><a id="n21_results" class="analyse_results">{{ n21 }}</a><a id="n21" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                    <th><a id="n22_results" class="analyse_results">{{ n22 }}</a><a id="n22" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                    <th><a id="n23_results" class="analyse_results">{{ n23 }}</a><a id="n23" class="analyse_list"><span
                            class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></th>
                </tr>
                </tbody>
            </table>
            <div class="info-box" id="info-box1">Click this icon to view a detailed list of differentially expressed
                genes
            </div>
            <div class="info-box" id="info-box2">Click to view detailed analysis results for this threshold</div>
            {#    火山图   #}
            <div id="volcanoPlot_Section" class="title">Volcano Plot of Differentially Expressed Genes with
                pvalue < {{ p }} and | FoldChange | > {{ fc }}</div>

            <div id="volcanoPlot" style="width: 900px;height: 600px;text-align: center;margin: auto;"></div>

            {#    网络   #}
            <div id="ppi" class="title">Protein–protein interaction network of Differentially Expressed Genes with
                pvalue < {{ p }} and | FoldChange | > {{ fc }}
            </div>
            <svg width="1270" height="820" id="ppi_container" {% if ppi %}show{% else %}hidden{% endif %}></svg>
            <div class="notext {% if ppi %}hidden{% else %}show{% endif %}">No interacting genes.</div>
            {#    中心性算法   #}
            <div id="centrality_Section" class="title">The centrality scores of each node in the PPI network ( top 10%
                )
            </div>
            <div {% if degree %}show{% else %}hidden{% endif %}>
                <div id="centrality_select_button">
                    <button onclick="degree()" class="centrality_button" id="Degree" value="Degree"
                            style="background-color: #eebde0">Degree
                    </button>
                    <button class="centrality_button" id="Radiality" value="Radiality">Radiality</button>
{#                    <button class="centrality_button" id="Closeness" value="Closeness">Closeness</button>#}
{#                    <button class="centrality_button" id="Betweenness" value="Betweenness">BC</button>#}
{#                    <button class="centrality_button" id="Stress" value="Stress">Stress</button>#}
                    <button class="centrality_button" id="EPC" value="EPC">EPC</button>
{#                    <button class="centrality_button" id="MCC" value="MCC">MCC</button>#}
                    <button class="centrality_button" id="MNC" value="MNC">MNC</button>
                    <button class="centrality_button" id="Katz" value="Katz">Katz</button>
{#                    <button class="centrality_button" id="BottleNeck" value="BottleNeck">BN</button>#}
                    <button class="centrality_button" id="Laplacian" value="Laplacian">Laplacian</button>
                    <button class="centrality_button" id="SLC" value="SLC">Semilocal</button>
                </div>
                <div id="Histogram" style="width: 900px;height: 600px;text-align: center;margin: auto;"></div>
            </div>
            <div {% if degree %}hidden{% else %}show{% endif %} class="notext">Too few network nodes</div>
            {#    富集分析   #}
            <div id="go_Section" class="title">GO Enrichment Analysis of Differentially Expressed Genes with
                pvalue < {{ p }} and | FoldChange | > {{ fc }}</div>
            <div id="goBubble" style="width: 1130px;height: 1000px;text-align: center;margin: -50px 0 -80px 0;"
                 class="Search-results {% if go_bp %}show{% endif %}"></div>
            <div class="notext {% if go_bp %}hidden{% else %}show{% endif %}">No GO function was enriched.</div>

            <div id="kegg_Section" class="title">KEGG Enrichment Analysis of Differentially Expressed Genes with
                pvalue < {{ p }} and | FoldChange | > {{ fc }}</div>
            <div id="keggBubble" style="width: 1130px;height: 1000px;text-align: center;margin: -90px 0 0 0;"
                 class="Search-results {% if kegg %}show{% endif %}"></div>
            <div class="notext {% if kegg %}hidden{% else %}show{% endif %}">No KEGG pathway was enriched.</div>
        </div>
    </div>
</div>
<div id="footer">Copyright © College of Bioinformatics Science and Technology，Harbin Medical University</div>
<script>
    {#$.ajaxSetup({#}
    {#    data: {csrfmiddlewaretoken: '{{ csrf_token }}'}})#}
    $(function () {
        loadSpecies();

        $('#navigation a').on('click', function (event) {
            var target = $($(this).attr('href'));
            event.preventDefault();
            var target = $(this).attr("href");
            $("html, body").animate({
                scrollTop: $(target).offset().top
            }, 500); // 滚动动画持续时间
        });

        $('#n11').css('cursor', 'pointer');
        $('#n12').css('cursor', 'pointer');
        $('#n13').css('cursor', 'pointer');
        $('#n21').css('cursor', 'pointer');
        $('#n22').css('cursor', 'pointer');
        $('#n23').css('cursor', 'pointer');
        $('#n11').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=1.2'
            $('#n11').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        $('#n12').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=1.5'
            $('#n12').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        $('#n13').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=2'
            $('#n13').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        $('#n21').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=1.2'
            $('#n21').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        $('#n22').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=1.5'
            $('#n22').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        $('#n23').click(function () {
            var href_data = 'DEGs/?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=2'
            $('#n23').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })

        $('#n11_results').css('cursor', 'pointer');
        $('#n12_results').css('cursor', 'pointer');
        $('#n13_results').css('cursor', 'pointer');
        $('#n21_results').css('cursor', 'pointer');
        $('#n22_results').css('cursor', 'pointer');
        $('#n23_results').css('cursor', 'pointer');
        $('#n11_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=1.2'
            $('#n11_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n11 }} == 0) {
            $('#n11_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n11_results').css("color", "grey");
            $("#n11_results").removeClass();
            $('#n11').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n11').css("color", "grey");
            $("#n11").removeClass();
        }

        $('#n12_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=1.5'
            $('#n12_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n12 }} == 0) {
            $('#n12_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n12_results').css("color", "grey");
            $("#n12_results").removeClass();
            $('#n12').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n12').css("color", "grey");
            $("#n12").removeClass();
        }

        $('#n13_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.05&fc=2'
            $('#n13_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n13 }} == 0) {
            $('#n13_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n13_results').css("color", "grey");
            $("#n13_results").removeClass();
            $('#n13').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n13').css("color", "grey");
            $("#n13").removeClass();
        }

        $('#n21_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=1.2'
            $('#n21_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n21 }} == 0) {
            $('#n21_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n21_results').css("color", "grey");
            $("#n21_results").removeClass();
            $('#n21').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n21').css("color", "grey");
            $("#n21").removeClass();
        }

        $('#n22_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=1.5'
            $('#n22_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n22 }} == 10) {
            $('#n22_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n22_results').css("color", "grey");
            $("#n22_results").removeClass();
            $('#n22').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n22').css("color", "grey");
            $("#n22").removeClass();
        }

        $('#n23_results').click(function () {
            var href_data = '?a={{ search_data1 }}&b={{ search_data2 }}&c={{ search_data3 }}&d={{ search_data4 }}&p=0.01&fc=2'
            $('#n23_results').attr("href", href_data);
            $.get("/search/", {'href_data': href_data});
        })
        if (0{{ n23 }} == 0) {
            $('#n23_results').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n23_results').css("color", "grey");
            $("#n23_results").removeClass();
            $('#n23').click(function (event) {
                event.preventDefault();
                // 这里可以添加你的自定义操作，而不会跳转到链接的URL
            });
            $('#n23').css("color", "grey");
            $("#n23").removeClass();
        }
    
        {#提示信息#}
        var triggerElement1 = $('.analyse_list');
        var infoBox1 = $('#info-box1');
        // 在鼠标移动事件中更新提示框位置
        triggerElement1.mousemove(function (event) {
            var mouseX = event.pageX;
            var mouseY = event.pageY;

            var infoBoxWidth = infoBox1.width();
            var infoBoxHeight = infoBox1.height();

            // 设置提示框的位置，例如，在鼠标正下方偏下一些
            var infoBoxLeft = mouseX + 10;
            var infoBoxTop = mouseY + 20; // 偏下10像素

            infoBox1.css({
                left: infoBoxLeft + 'px',
                top: infoBoxTop + 'px',
                position: 'absolute',
            });
        });

        // 鼠标移入事件
        triggerElement1.mouseenter(function () {
            infoBox1.show();
        });

        // 鼠标移出事件
        triggerElement1.mouseleave(function () {
            infoBox1.hide();
        });


        {#提示信息#}
        var triggerElement2 = $('.analyse_results');
        var infoBox2 = $('#info-box2');
        // 在鼠标移动事件中更新提示框位置
        triggerElement2.mousemove(function (event) {
            var mouseX = event.pageX;
            var mouseY = event.pageY;

            var infoBoxWidth = infoBox2.width();
            var infoBoxHeight = infoBox2.height();

            // 设置提示框的位置，例如，在鼠标正下方偏下一些
            var infoBoxLeft = mouseX + 10;
            var infoBoxTop = mouseY + 20; // 偏下10像素

            infoBox2.css({
                left: infoBoxLeft + 'px',
                top: infoBoxTop + 'px',
                position: 'absolute',
            });
        });

        // 鼠标移入事件
        triggerElement2.mouseenter(function () {
            infoBox2.show();
        });

        // 鼠标移出事件
        triggerElement2.mouseleave(function () {
            infoBox2.hide();
        });


        $('#Degree').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Degree'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in degree_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#Radiality').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Radiality'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in Radiality_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#EPC').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Edge Percolated Component'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in EPC_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#MNC').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Maximum Neighborhood Component'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in MNC_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#Katz').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Katz Centricity'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in Katz_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#SLC').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Semi local centrality'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in SLC_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        $('#Laplacian').click(function () {
            $(".centrality_button").css({"background-color": "#94b8e5"})
            $(this).css({"background-color": "#eebde0"})
            var chart = Highcharts.chart('Histogram', {
                chart: {
                    type: 'column'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Laplacian centrality'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45  // 设置轴标签旋转角度
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'score'
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
                },
                {% if centrality_number < 10 %}
                plotOptions:{
                    column:{
                        pointWidth:40// 在这里设置柱子宽度
                    }
                },
                {% endif %}
                series: [{
                    data: [{% for obj1 in Laplacian_list %}{{ obj1|safe }}, {% endfor %}],
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                        y: 10
                    }
                }]
            });
        })

        keggBubblePlot();
        goBubblePlot();

        var supnav = document.getElementById("supnav");
        var nav = document.getElementById("menu1");
        var btns = nav.getElementsByTagName("li");
        var subnavs = nav.getElementsByTagName("div");
        var paddingbottom = 20;
        var defaultHeight = 0;

    })



    function drop(obj, ivalue) {
        var a = obj.offsetHeight;
        var speed = (ivalue - obj.offsetHeight) / 8;
        a += Math.floor(speed);
        obj.style.height = a + "px";
    }

    $('#menu1').ready(
        function () {
            var i = 1;
            btns[i].index = i;
            btns[i].onmouseover = function () {
                var osubnav = subnavs[0];
                var sublinks = osubnav.getElementsByTagName("a");
                if (osubnav.firstChild.tagName == undefined) {
                    var itarheight = parseInt(osubnav.childNodes[1].offsetHeight) * sublinks.length + paddingbottom;
                } else {
                    var itarheight = parseInt(osubnav.firstChild.offsetHeight) * sublinks.length + paddingbottom;
                }
                clearInterval(this.itimer);
                this.itimer = setInterval(function () {
                        drop(osubnav, itarheight);
                    },
                    30);
            };
            btns[i].onmouseout = function () {
                var osubnav = subnavs[0];
                clearInterval(this.itimer);
                this.itimer = setInterval(function () {
                        drop(osubnav, defaultHeight);
                    },
                    30);
            };
        }
    );

    $('#menu1').ready(
        function () {
            var i = 4;
            btns[i].index = i;
            btns[i].onmouseover = function () {
                var osubnav = subnavs[1];
                var sublinks = osubnav.getElementsByTagName("a");
                if (osubnav.firstChild.tagName == undefined) {
                    var itarheight = parseInt(osubnav.childNodes[1].offsetHeight) * sublinks.length + paddingbottom;
                } else {
                    var itarheight = parseInt(osubnav.firstChild.offsetHeight) * sublinks.length + paddingbottom;
                }
                clearInterval(this.itimer);
                this.itimer = setInterval(function () {
                        drop(osubnav, itarheight);
                    },
                    30);
            };
            btns[i].onmouseout = function () {
                var osubnav = subnavs[1];
                clearInterval(this.itimer);
                this.itimer = setInterval(function () {
                        drop(osubnav, defaultHeight);
                    },
                    30);
            };
        }
    );

    function loadSpecies() {
        loadSearch(0, 'species', loadDrug);
    }

    function loadDrug() {
        loadSearch($('#species option:selected').attr('id'), 'drug', loadArea);
    }

    function loadArea() {
        loadSearch($('#drug option:selected').attr('id'), 'area', loadDataset);
    }

    function loadDataset() {
        loadSearch($('#area option:selected').attr('id'), 'dataset');
    }

    function loadSearch(pid, selectID, nextLoad) {
        $('#' + selectID).empty();
        $.get('/getInfo/', {'pid': pid}, function (result) {
            var searchList = JSON.parse(result.jareaList);
            for (var i = 0; i < searchList.length; i++) {
                var sear = searchList[i];
                $('#' + selectID).append("<option id='" + sear.pk + "' value='" + sear.fields.areaname + "'>" + sear.fields.areaname + "</option>");
            }
            if (nextLoad != null) {
                nextLoad();
            }
        });
    }


    {#火山图#}
    var chart = Highcharts.chart('volcanoPlot', {
        chart: {
            type: 'scatter',
            zoomType: 'xy'
        },
        credits: {
            enabled: false
        },
        title: {
            text: 'VolcanoPlot',
            style: {
                fontSize: '20px'
            }
        },
        xAxis: {
            labels: {
                style: {
                    fontSize: '13px'
                }
            },
            title: {
                enabled: true,
                text: 'log2FoldChange',
                style: {
                    fontSize: '15px'
                }
            },
            startOnTick: true,
            endOnTick: true,
            showLastLabel: true,
            plotLines: [{
                color: 'black',
                dashStyle: 'dot',
                width: 2,
                value: Math.log2({{ fc }}),
                label: {
                    rotation: 0,
                    y: 15,
                    style: {
                        fontStyle: 'italic'
                    },
                },
                zIndex: 3
            }, {
                color: 'black',
                dashStyle: 'dot',
                width: 2,
                value: -Math.log2({{ fc }}),
                label: {
                    rotation: 0,
                    y: 15,
                    style: {
                        fontStyle: 'italic'
                    },
                },
                zIndex: 3
            }]
        },
        yAxis: {
            labels: {
                style: {
                    fontSize: '13px'
                }
            },
            title: {
                text: '-log10 P-value',
                style: {
                    fontSize: '15px'
                }
            },
            plotLines: [{
                color: 'black',
                dashStyle: 'dot',
                width: 2,
                value: -Math.log10({{ p }}),
                label: {
                    rotation: 0,
                    y: 15,
                    style: {
                        fontStyle: 'italic'
                    },
                },
                zIndex: 3
            }]
        },
        legend: {
            itemStyle: {
                fontSize: '13px'
            },
            title: {
                text: 'Expression',
                style: {
                    fontSize: '15px'
                }
            },
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            x: 10,
            y: 220,
            floating: false,
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
            borderWidth: 1
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size: 13px; font-weight: bold;">{series.name}</span><br>',
                    pointFormat: '<span style="font-size: 13px">log2FoldChange : {point.x}<br>-log10 P.Value : {point.y}</span>',
                    fontSize: '13px'
                }
            }
        },
        series: [{
            name: 'Up-regulation',
            color: 'rgba(223,40,44,0.5)',
            data: [{% for obj1 in table_list1 %}{{ obj1 }}, {% endfor %}]
        }, {
            name: 'Unchanged',
            color: 'rgba(115,109,115,0.5)',
            data: [{% for obj3 in table_list3 %}{{ obj3 }}, {% endfor %}]
        }, {
            name: 'Down-regulation',
            color: 'rgba(31,91,191,0.71)',
            data: [{% for obj2 in table_list2 %}{{ obj2 }}, {% endfor %}]
        }]
    });

    {#网络#}
    var links = [
        {% for i,j in zipped_ppi %}
            {
                "source": "{{ i }}",
                "target": "{{ j }}"
            },
        {% endfor %}
    ]

    var width = 1370,
        height = 820;

    //初始化缩放方法
    var zoom = d3.behavior.zoom()//缩放配置，
        .scaleExtent([0.4, 2])//缩放比例
        .on("zoom", zoomed);

    function zoomed() {//缩放函数
        {#svg.selectAll("g").attr("transform","translate(160,167)scale(0.8)")#}
        svg.selectAll("g").attr("transform",//svg下的g标签移动大小
            "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    }

    var svg = d3.select('svg#ppi_container')
        .call(zoom);

    {#zoom.translate([160,167]);#}
    {#zoom.scale(zoom.scale() * 0.8);#}
    {#svg.selectAll("g").attr("transform","translate(160,167)scale(0.8)");#}

    var nodes = {} // parse links to nodes
    links.forEach(function (link) { // for loop
        link.source = nodes[link.source] ||
            (nodes[link.source] = {name: link.source});
        link.target = nodes[link.target] ||
            (nodes[link.target] = {name: link.target});
    });
    var intersection_list = [{{ intersection_list|safe }}];
    for (var key in nodes) {
        if (intersection_list[0].includes(nodes[key].name)) {
            nodes[key].group = '1'
        } else {
            nodes[key].group = '2'
        }
    }

    svg.append('rect')
        .attr('width', '100%')
        .attr('height', '100%')
        .attr('fill', 'white')
        .on('click', function () {
            // Restore nodes and links to normal opacity.
            {#d3.selectAll('.link').style('stroke-opacity', '0.6');#}
            d3.selectAll('.node').style('opacity', '1');
        });
    {#var link = svg.selectAll('.link')#}
    var link = svg.append("g").selectAll('.link')
    {#.selectAll("line")#}
        .data(links)
        .enter().append('line') // append connection for curved line append path
        .attr('class', 'link');

    var force = d3.layout.force()
        .size([1170, 820])
        .nodes(d3.values(nodes))
        .links(links)
        .gravity(0.25)
        .theta(0.6)
        .on("tick", tick)
        .linkDistance(10)
        .charge(-350)
        .alpha(0)
        .start();
    var color = ["#ff2f0d", "#899eff"];
    var node = svg.append("g").selectAll('.node')
        .attr("stroke-width", 1.5)
        .data(force.nodes())
        .enter().append("circle")
        .attr("class", "node")
        {#.attr('r', width * 0.005)#}
        .attr('r', function (d) {
            return d.weight / 3 + 4;
        })
        .style("fill", function (d) {
            return color[d.group - 1];
        })
    {#.attr('fill', d => color(d.group))#}
    {#.call(drag());//使顶点可以被拖动#}

    node.append("text")
        .attr("dy", "3em")
        .text(d => d.name)
        .style("text-anchor", "middle");

    {#var text = svg.selectAll('.text')#}
    var text = svg.append("g").selectAll('.text')
        .data(force.nodes())
        .enter().append("text")
        .text(d => d.name)
        .style("display", "none")
        .style("font-size", "20px")
        .style("stroke", "red")
        {#.call(drag())#}
        .attr("y", function (d, i) {
            return 20;
        })
        .attr("x", function (d, i) {
                return 30;
            }
        );

    function drag() {//拖拽函数
        return force.drag()
            .on("dragstart", function (d) {
                d3.event.sourceEvent.stopPropagation(); //取消默认事件
                d.fixed = true;    //拖拽开始后设定被拖拽对象为固定
            })
            .on("drag", function (d) {
                d3.select(this).attr("cx", d.x = d3.event.x).attr("cy", d.y = d3.event.y)
            })
            .on("dragend", function (d) {
                d3.select(this).classed("dragging", false)
            });
    }

    svg.selectAll(".node,.link, text").call(drag());//为svg下的所有g标签添加拖拽事件
    {#svg.selectAll("g").call(drag());//为svg下的所有g标签添加拖拽事件#}
    node.on("mouseover", (d) => {
        text.style('display', t => (t.name === d.name) ? "inline" : "none");
        link.style('stroke-opacity', l => ((d === l.source) | (d === l.target) ? 1 : 0.05));
    })
        .on("mouseout", (d) => {
            text.style("display", "none");
            link.style("stroke-opacity", 0.1);
        });

    function tick(e) {
        node.attr("cx", function (d) {
            return d.x;
        })
            .attr("cy", function (d) {
                return d.y;
            });

        text.attr("x", function (d) {
            return d.x - 30;
        })
            .attr("y", function (d) {
                return d.y - 8;
            })


        link.attr("x1", function (d) {
            return d.source.x;
        })
            .attr("y1", function (d) {
                return d.source.y;
            })
            .attr("x2", function (d) {
                return d.target.x;
            })
            .attr("y2", function (d) {
                return d.target.y;
            })
    }

    {#柱状图#}
    var chart = Highcharts.chart('Histogram', {
        chart: {
            type: 'column'
        },
        credits: {
            enabled: false
        },
        title: {
            text: 'Degree'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45  // 设置轴标签旋转角度
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'score'
            }
        },
        legend: {
            enabled: false
        },
        tooltip: {
            pointFormat: '<span style="font-size: 15px">Score:<br>{point.y:.1f}</span>'
        },
        {% if centrality_number < 10 %}
            plotOptions: {
                column: {
                    pointWidth: 40// 在这里设置柱子宽度
                }
            },
        {% endif %}
        series: [{
            data: [{% for obj1 in degree_list %}{{ obj1|safe }}, {% endfor %}],
            {#data: {{ degree_list|safe  }},#}
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: '#FFFFFF',
                align: 'right',
                format: '{point.y:.2f}', // :.1f 为保留 1 位小数
                y: 10
            }
        }]
    });

    {#富集分析GO气泡图#}

    function goBubblePlot() {
        var myChart1 = echarts.init(document.getElementById('goBubble'));
        const dataBP = [{% for go1 in BP_list %}{{ go1|safe }}, {% endfor %}];
        const dataCC = [{% for go2 in CC_list %}{{ go2|safe }}, {% endfor %}];
        const dataMF = [{% for go3 in MF_list %}{{ go3|safe }}, {% endfor %}];
        const schema = [
            {name: 'Pathwayname', index: 0, text: 'GO term'},
            {name: 'Genecount', index: 1, text: 'Count'},
            {name: 'pvalue', index: 2, text: 'pvalue'},
            {name: 'p.adjust', index: 3, text: 'p.adjust'},
            {name: 'qvalue', index: 4, text: 'qvalue'},
            {name: 'Genename', index: 5, text: 'Gene'}
        ];
        const itemStyle = {
            opacity: 0.8,
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowOffsetY: 0,
            shadowColor: 'rgba(0,0,0,0.3)'
        };
        var option = {
            color: ['#dd4444', '#fec42c', '#80F1BE'],
            legend: {
                top: 105,
                data: ['BP', 'CC', 'MF'],
                textStyle: {
                    fontSize: 20
                }
            },
            grid: {
                left: '5%',
                right: 150,
                top: '18%',
                containLabel: true,
                bottom: '10%'
            },
            tooltip: {
                backgroundColor: 'rgba(255,255,255,0.7)',
                confine: true,
                formatter: function (param) {
                    var value = param.value;
                    // prettier-ignore
                    return '<div style="width: 600px; white-space: pre-wrap; word-break: break-all">' +
                        '<div style="border-bottom: 1px solid rgba(255,255,255,.3);font-weight: bold; font-size: 18px;padding-bottom: 7px;margin: 7px 0 -8px 0">'
                        + schema[0].text + '：' + value[1] + '<br>'
                        + '</div>'
                        + schema[1].text + '：' + value[0] + '<br>'
                        + schema[2].text + '：' + value[2] + '<br>'
                        + schema[3].text + '：' + value[3] + '<br>'
                        + schema[4].text + '：' + value[4] + '<br>'
                        + schema[5].text + '：' + value[5]
                        + '</div>';
                },
                {#extraCssText:'width:650px; white-space: pre-wrap; word-break: break-word;'#}
            },
            title: {
                show: true,//false
                text: "The Most Enriched GO Terms",//主标题文本
                left: 'center', // 标题居中
                top: 60, // 距离上边框20像素
                textStyle: {
                    {#color: '#ccc',//'red'，字体颜色#}
                    fontStyle: 'normal',//'italic'(倾斜) | 'oblique'(倾斜体) ，字体风格
                    fontWeight: 'normal',//'bold'(粗体) | 'bolder'(粗体) | 'lighter'(正常粗细) ，字体粗细
                    fontFamily: 'sans-serif',//'sans-serif' | 'serif' | 'monospace' | 'Arial' | 'Courier New'
                    fontSize: 30,//字体大小
                    lineHeight: 18,//字体行高
                }
            },
            xAxis: {
                type: 'value',
                name: 'Gene Number',
                max: {{ GO_count_max }}+1,
                min: {{ GO_count_min }}-1,
                nameGap: 16,
                nameTextStyle: {
                    fontSize: 16
                },
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'category',
                data: [{% for go4 in GO_name %}'{{ go4 }}',{% endfor %}],
                name: 'GO term',
                nameLocation: 'end',
                triggerEvent: true,
                nameGap: 10,
                nameTextStyle: {
                    fontSize: 16
                },
                splitLine: {
                    show: true
                }
            },
            visualMap: [
                {
                    left: 'right',
                    top: '25%',
                    dimension: 0,
                    max: {{ GO_count_max }}+0,
                    min: {{ GO_count_min }}+0,
                    itemWidth: 30,
                    itemHeight: 120,
                    calculable: true,
                    precision: 0.1,
                    text: ['Count'],
                    textGap: 10,
                    inRange: {
                        symbolSize: [10, 38]
                    },
                    outOfRange: {
                        symbolSize: [10, 38],
                        color: ['rgba(255,255,255,0.4)']
                    },
                    controller: {
                        inRange: {
                            color: ['#c23531']
                        },
                        outOfRange: {
                            color: ['#999']
                        }
                    }
                },
                {
                    left: 'right',
                    bottom: '25%',
                    dimension: 3,
                    max: {{ GO_padjust_max }}+0,
                    min: {{ GO_padjust_min }}+0,
                    itemHeight: 120,
                    precision: 20,
                    text: ['p.adjust'],
                    textGap: 10,
                    inRange: {
                        colorLightness: [0.5, 0.9]
                    },
                    outOfRange: {
                        color: ['rgba(255,255,255,0.4)']
                    },
                    controller: {
                        inRange: {
                            color: ['#c23531']
                        },
                        outOfRange: {
                            color: ['#999']
                        }
                    }
                }
            ],
            series: [
                {
                    name: 'BP',
                    type: 'scatter',
                    itemStyle: itemStyle,
                    data: dataBP
                },
                {
                    name: 'CC',
                    type: 'scatter',
                    itemStyle: itemStyle,
                    data: dataCC
                },
                {
                    name: 'MF',
                    type: 'scatter',
                    itemStyle: itemStyle,
                    data: dataMF
                }
            ]
        };
        myChart1.setOption(option);
        myChart1.on('click', function (e) {
            if (e.componentType == 'yAxis'){
                var go_name = e.value;
            }else if (e.componentType == 'series'){
                var go_name = e.data[1];
            }
            var go_list = [{{ GO_list|safe }}];
            var go_id;
            for (let i in go_list[0]) {
                if (go_list[0][i][1] == go_name) {
                    go_id = go_list[0][i][6]
                }
            }
            window.location.href = 'https://amigo.geneontology.org/amigo/term/' + go_id;
        })
    }

    {#富集分析KEGG气泡图#}

    function keggBubblePlot() {
        var myChart2 = echarts.init(document.getElementById('keggBubble'));
        const dataBJ = [{% for obj1 in kegg_list %}{{ obj1|safe }}, {% endfor %}];
        const schema = [
            {name: 'Pathwayname', index: 0, text: 'Pathway'},
            {name: 'Genecount', index: 1, text: 'Count'},
            {name: 'pvalue', index: 2, text: 'pvalue'},
            {name: 'p.adjust', index: 3, text: 'p.adjust'},
            {name: 'qvalue', index: 4, text: 'qvalue'},
            {name: 'Genename', index: 5, text: 'Gene'}
        ];
        const itemStyle = {
            opacity: 0.8,
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowOffsetY: 0,
            shadowColor: 'rgba(0,0,0,0.3)'
        };
        var option = {
            color: ['#dd4444'],
            grid: {
                left: '5%',
                right: 150,
                top: '18%',
                containLabel: true,
                bottom: '10%'
            },
            tooltip: {
                backgroundColor: 'rgba(255,255,255,0.7)',
                confine: true,
                formatter: function (param) {
                    var value = param.value;
                    // prettier-ignore
                    return '<div style="width: 600px; white-space: pre-wrap; word-break: break-all"><div style="border-bottom: 1px solid rgba(255,255,255,.3);font-weight: bold; font-size: 18px;padding-bottom: 7px;margin: 7px 0 -8px 0">'
                        + schema[0].text + '：' + value[1] + '<br>'
                        + '</div>'
                        + schema[1].text + '：' + value[0] + '<br>'
                        + schema[2].text + '：' + value[2] + '<br>'
                        + schema[3].text + '：' + value[3] + '<br>'
                        + schema[4].text + '：' + value[4] + '<br>'
                        + schema[5].text + '：' + value[5]
                        + '</div>';
                }
            },
            title: {
                show: true,//false
                text: "KEGG Pathways Enrichment",//主标题文本
                left: 'center', // 标题居中
                top: 100, // 距离上边框20像素
                textStyle: {
                    {#color: '#ccc',//'red'，字体颜色#}
                    fontStyle: 'normal',//'italic'(倾斜) | 'oblique'(倾斜体) ，字体风格
                    fontWeight: 'normal',//'bold'(粗体) | 'bolder'(粗体) | 'lighter'(正常粗细) ，字体粗细
                    fontFamily: 'sans-serif',//'sans-serif' | 'serif' | 'monospace' | 'Arial' | 'Courier New'
                    fontSize: 30,//字体大小
                    lineHeight: 18,//字体行高
                }
            },
            xAxis: {
                type: 'value',
                name: 'Gene Number',
                max: {{ kegg_count_max }}+1,
                min: {{ kegg_count_min }}-1,
                nameGap: 16,
                nameTextStyle: {
                    fontSize: 16
                },
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'category',
                data: [{% for obj1 in kegg_name %}'{{ obj1 }}',{% endfor %}],
                name: 'Pathways',
                triggerEvent: true,
                nameLocation: 'end',
                nameGap: 10,
                nameTextStyle: {
                    fontSize: 16
                },
                splitLine: {
                    show: true
                }
            },
            visualMap: [
                {
                    left: 'right',
                    top: '25%',
                    dimension: 0,
                    max: {{ kegg_count_max }}+0,
                    min: {{ kegg_count_min }}+0,
                    itemWidth: 30,
                    itemHeight: 120,
                    calculable: true,
                    precision: 0.1,
                    text: ['Count'],
                    textGap: 10,
                    inRange: {
                        symbolSize: [10, 38]
                    },
                    outOfRange: {
                        symbolSize: [10, 38],
                        color: ['rgba(255,255,255,0.4)']
                    },
                    controller: {
                        inRange: {
                            color: ['#dd4444']
                        },
                        outOfRange: {
                            color: ['#999']
                        }
                    }
                },
                {
                    left: 'right',
                    bottom: '25%',
                    dimension: 3,
                    // max: 0.00309255,
                    // min: 6.66E-11,
                    max: {{ kegg_padjust_max }}+0,
                    min: {{ kegg_padjust_min }}+0,
                    itemHeight: 120,
                    precision: 20,
                    text: ['p.adjust'],
                    textGap: 10,
                    inRange: {
                        // colorLightness: [1.34E-09, 2.6314036595041E-13]
                        colorLightness: [0.5, 0.9]
                    },
                    outOfRange: {
                        color: ['rgba(255,255,255,0.4)']
                    },
                    controller: {
                        inRange: {
                            color: ['#dd4444']
                        },
                        outOfRange: {
                            color: ['#999']
                        }
                    }
                }
            ],
            series: [
                {
                    type: 'scatter',
                    itemStyle: itemStyle,
                    data: dataBJ
                }
            ]
        };
        myChart2.setOption(option);
        myChart2.on('click', function (e) {
            if (e.componentType == 'yAxis'){
                var kegg_name = e.value;
            }else if (e.componentType == 'series'){
                var kegg_name = e.data[1];
            }
            var kegg_list = [{{ kegg_list|safe }}];
            {#var kegg_list = [{% for kegg_list1 in kegg_list %}'{{ kegg_list1|safe }}',{% endfor %}];#}
            var kegg_id;
            {#for(i=0;i<=length(kegg_list);i++){#}
            {#    console.log(kegg_list[1])}#}
            for (let i in kegg_list[0]) {
                {#console.log(kegg_list[0][i][1])#}
                if (kegg_list[0][i][1] == kegg_name) {
                    kegg_id = kegg_list[0][i][6]
                }
            }
            window.location.href = 'https://www.kegg.jp/entry/' + kegg_id;
        })
    }

</script>
{#    <script type="text/javascript" src="http://127.0.0.1:8000/static/js/jquery-3.6.0.min.js"></script>#}
<script src="../static/js/browse_Menu.js"></script>
</body>
</html>